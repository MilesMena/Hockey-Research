%first we define our ode function we will need to define all the state changes with a number (for example w(1) is equivalent to w(1,1,t), w(2) is equivalent to w(1,0,t). I tried using w_11 and w_10 but it didn't work. they seem to want w(1) to represent the first differential equation
clear all;
close all;
%odefun=@(t,w)[0.000637465*w(2) + 0.001548129*w(10) + 0.001548129*w(28) + 0.003460523*w(29) - 0.007194245*w(1); 0.000879642*w(3) + 0.001185604*w(29) + 0.001070869*w(1) + 0.001185604*w(29) + 0.000191227*w(12)  + 0.00122385*w(28) - 0.005736796*w(2); 0.000666339*w(4) + 0.001616691*w(12)  + 0.000644492*w(2) + 0.001310831*w(30) + 0.0000546179*w(13)  + 0.0000764651*w(29) - 0.004369436*w(3); 0.000944904*w(5) + 0.00136152*w(13) + 0.000661432*w(3) + 0.001597746*w(31) + 0.000107375*w(14) + 0.000115965*w(30) - 0.004788943*w(4); 0.000920289*w(6) + 0.00214734*w(14) + 0.001693783*w(32) + 0.000756556*w(4) + 0.000137385*w(15) +	0.000116683*w(31) - 0.005772036*w(5); 0.000614326*w(7) + 0.001781546*w(15) + 0.00138906*w(33) + 0.000846405*w(5) +0.000133104*w(16) + 0.0000819101*w(32) - 0.00484635*w(6); 0.001734931*w(16) + 0.000688607*w(8) + 0.000786979*w(6) + 0.001395099*w(34) + 0.0000894294*w(17) + 0.000134144*w(33) - 0.00482919*w(7); 0.001596994*w(17) + 0.000626272*w(9) + 0.000657586*w(7) + 0.001659621*w(35) + 0.000156568*w(18) + 0.0000626272*w(34) - 0.004759668*w(8); 0.001857355*w(18) + 0.002897474*w(36) + 0.000445765*w(8) - 0.00520059*w(9); 0.001987578*w(19) + 0.000496894*w(11) + 0.00173913*w(1) + 0.000496894*w(20) - 0.004720497*w(10); 0.000461681*w(12) + 0.003099855*w(20) + 0.0000659544*w(10) + 0.002967946*w(2) + 0.0000659544*w(21) + 0.000131909*w(1) - 0.006793299*w(11); 0.000552513*w(13) + 0.003218987*w(21) + 0.000360334*w(11) + 0.002210051*w(11) + 0.000144134*w(3) +0.000168156*w(2) - 0.006654175*w(12); 0.000457108*w(14) + 0.003156222*w(22) + 0.000282972*w(12) + 0.002361725*w(4) + 0.000163253*w(23) + 0.000130602*w(3) - 0.006551882*w(13); 0.000477031*w(15) + 0.002495514*w(23) + 0.00275539*w(5) + 0.000281235*w(13) + 0.000149517*w(24) + 0.000177997*w(4) - 0.006336684*w(14); 0.000408706*w(16) + 0.00286743*w(24) + 0.000382756*w(14) + 0.003172338*w(6) + 0.000337345*w(5) + 0.000259496*w(25) - 0.007428071*w(15); 0.00054355*w(17) + 0.002644298*w(25) + 0.000455407*w(15) + 0.003261301*w(7)  + 0.000220358*w(26) + 0.000249739*w(6) - 0.007374653*w(16); 0.000431841*w(18) + 0.004078499*w(26) + 0.000479823*w(16)+ 0.002782976*w(8)+ 0.000335876*w(27) + 0.000479823*w(7) - 0.008588839*w(17); 0.003983157*w(27) + 0.003869352*w(9) + 0.003186526*w(8) - 0.007852509*w(18); 0.001647786*w(20) + 0.000205973*w(10) + 0.000205973*w(29) - 0.002059732*w(19); 0.001067934*w(21) + 0.000447843*w(19) + 0.00068899*w(11) + 0.000068899*w(10) - 0.002273667*w(20); 0.000943877*w(22) + 0.000620971*w(20) + 0.001142587*w(12) + 0.0000745166*w(11) - 0.002782*w(21); 0.000839083*w(23) + 0.000619715*w(21) + 0.000959735*w(13) + 0.0000658104*w(12) - 0.002484343*w(22); 0.000978382*w(24) + 0.000604954*w(22) + 0.001829799*w(14) + 0.000896228*w(13) - 0.003502758*w(23); 0.000821121*w(25)	+ 0.00060021*w(23) + 0.001571383*w(15) +0.000696077*w(14) - 0.003688791*w(24); 0.000911702*w(26) + 0.000507263*w(24) + 0.001350416*w(16) +0.0000548392*w(15) - 0.00282422*w(25); 0.000900452*w(27) + 0.000609536*w(25) + 0.001177514*w(17) + 0.000110825*w(16) - 0.002798327*w(26); 0.000697859*w(26) + 0.001268834*w(18) + 0.0000317209*w(17) - 0.001998414*w(27); 0.0000910664*w(1) + 0.001514548*w(37) + 0.00065017*w(2) - 0.00225578*w(28); 0.0000382453*w(2) + 0.001264066*w(30) + 0.000093668*w(38)+ 0.007881176*w(28) + 0.000239139*w(37) - 0.00951629*w(29); 0.003643484*w(3) + 0.000470926*w(31) + 0.000322213*w(4) + 0.002552917*w(39) + 0.000297427*w(29) + 0.000173499*w(38) - 0.00746047*w(30); 0.003517065*w(4) + 0.00035927*w(32) + 0.002429801*w(40) + 0.000397088*w(30) + 0.00035927*w(5) + 0.000170181*w(39) - 0.00723267*w(31); 0.00306151*w(5) + 0.000346084*w(33) + 0.002249544*w(41) + 0.000341647*w(31) + 0.000141983*w(40) + 0.000150857*w(6) - 0.00629162*w(32); 0.002976512*w(6) + 0.000216116*w(34) + 0.002524632*w(42) + 0.000579585*w(32) + 0.00025541*w(7) + 0.000186646*w(41) - 0.0067389*w(33); 0.002740699*w(7) + 0.00048216*w(35) + 0.002639192*w(43) + 0.000558291*w(33) + 0.000203015*w(42) + 0.000126884*w(8)- 0.00675024*w(34); 0.001699096*w(8) + 0.000274048*w(36) + 0.002904905*w(44) + 0.000383667*w(34) + 0.000274048*w(9) + 0.000164429*w(43) - 0.00570019*w(35); 0.003182086*w(9) + 0.00023571*w(17) + 0.002710666*w(45) + 0.000117855*w(44) - 0.00624632*w(36); 0.00079713*w(28) + 0.000478278*w(38) + 0.000079713*w(29) - 0.00135512*w(37); 0.001092794*w(29) + 0.000530786*w(39) + 0.000124891*w(30) + 0.000811799*w(37) - 0.00256026*w(38); 0.001330202*w(30) + 0.000527287*w(40) + 0.0000479352*w(31) + 0.000814898*w(38) - 0.00272032*w(39); 0.001523857*w(31) + 0.00057392*w(41) + 0.000125339*w(14) - 0.00222312*w(40); 0.002134845*w(32) + 0.000943172*w(40) + 0.000632547*w(42) + 0.00012425*w(33) - 0.003834815*w(41);0.00064671*w(43) + 0.00083599*w(41) + 0.00015773*w(34) + 0.00132338*w(34)- 0.00291019*w(42); 0.001323377*w(34) +0.000812931*w(44) + 0.001001985*w(42) + 0.0000945269*w(35) - 0.00323282*w(43); 0.001495265*w(35) + 0.000539957*w(45) + 0.000830703*w(43)+ 0.0000830703*w(36) - 0.00294899*w(44); 0.001890084*w(36) + 0.000581564*w(44) - 0.00247165*w(45)]; %This defines the dif eq wrt t and the various equations, you will have as many equations as state changes
odefun=@(t,w)[0.000637465*w(2) + 0.001548129*w(10) + 0.001548129*w(28) + 0.003460523*w(29) - 0.007194245*w(1); 
    0.000879642*w(3) + 0.001185604*w(29) + 0.001070869*w(1) + 0.001185604*w(29) + 0.000191227*w(12)  + 0.00122385*w(28) - 0.005736796*w(2); 
    0.000666339*w(4) + 0.001616691*w(12)  + 0.000644492*w(2) + 0.001310831*w(30) + 0.0000546179*w(13)  + 0.0000764651*w(29) - 0.004369436*w(3); 
    0.000944904*w(5) + 0.00136152*w(13) + 0.000661432*w(3) + 0.001597746*w(31) + 0.000107375*w(14) + 0.000115965*w(30) - 0.004788943*w(4); 
    0.000920289*w(6) + 0.00214734*w(14) + 0.001693783*w(32) + 0.000756556*w(4) + 0.000137385*w(15) +	0.000116683*w(31) - 0.005772036*w(5); 
    0.000614326*w(7) + 0.001781546*w(15) + 0.00138906*w(33) + 0.000846405*w(5) + 0.000133104*w(16) + 0.0000819101*w(32) - 0.00484635*w(6); 
    0.001734931*w(16) + 0.000688607*w(8) + 0.000786979*w(6) + 0.001395099*w(34) + 0.0000894294*w(17) + 0.000134144*w(33) - 0.00482919*w(7); 
    0.001596994*w(17) + 0.000626272*w(9) + 0.000657586*w(7) + 0.001659621*w(35) + 0.000156568*w(18) + 0.0000626272*w(34) - 0.004759668*w(8); 
    0.001857355*w(18) + 0.002897474*w(36) + 0.000445765*w(8) - 0.00520059*w(9);
    0.001987578*w(19) + 0.000496894*w(11) + 0.00173913*w(1) + 0.000496894*w(20) - 0.004720497*w(10); 
    0.000461681*w(12) + 0.003099855*w(20) + 0.0000659544*w(10) + 0.002967946*w(2) + 0.0000659544*w(21) + 0.000131909*w(1) - 0.006793299*w(11); 
    0.000552513*w(13) + 0.003218987*w(21) + 0.000360334*w(11) + 0.002210051*w(11) + 0.000144134*w(3) + 0.000168156*w(2) - 0.006654175*w(12); 
    0.000457108*w(14) + 0.003156222*w(22) + 0.000282972*w(12) + 0.002361725*w(4) + 0.000163253*w(23) + 0.000130602*w(3) - 0.006551882*w(13); 
    0.000477031*w(15) + 0.002495514*w(23) + 0.00275539*w(5) + 0.000281235*w(13) + 0.000149517*w(24) + 0.000177997*w(4) - 0.006336684*w(14); 
    0.000408706*w(16) + 0.00286743*w(24) + 0.000382756*w(14) + 0.003172338*w(6) + 0.000337345*w(5) + 0.000259496*w(25) - 0.007428071*w(15); 
    0.00054355*w(17) + 0.002644298*w(25) + 0.000455407*w(15) + 0.003261301*w(7)  + 0.000220358*w(26) + 0.000249739*w(6) - 0.007374653*w(16); 
    0.000431841*w(18) + 0.004078499*w(26) + 0.000479823*w(16)+ 0.002782976*w(8)+ 0.000335876*w(27) + 0.000479823*w(7) - 0.008588839*w(17); 
    0.003983157*w(27) + 0.003869352*w(9) + 0.003186526*w(8) + .0001138*w(17)  - 0.011152839*w(18); 
    0.001647786*w(20) + 0.000205973*w(10) + 0.000205973*w(29) - 0.002059732*w(19); 
    0.001067934*w(21) + 0.000447843*w(19) + 0.00068899*w(11) + 0.000068899*w(10) - 0.002273667*w(20); 
    0.000943877*w(22) + 0.000620971*w(20) + 0.001142587*w(12) + 0.0000745166*w(11) - 0.002782*w(21); 
    0.000839083*w(23) + 0.000619715*w(21) + 0.000959735*w(13) + 0.0000658104*w(12) - 0.002484343*w(22); 
    0.000978382*w(24) + 0.000604954*w(22) + 0.001829799*w(14) + 0.000896228*w(13) - 0.003502758*w(23); 
    0.000821121*w(25)	+ 0.00060021*w(23) + 0.001571383*w(15) + 0.000696077*w(14) - 0.003688791*w(24); 
    0.000911702*w(26) + 0.000507263*w(24) + 0.001350416*w(16) + 0.0000548392*w(15) - 0.00282422*w(25); 
    0.000900452*w(27) + 0.000609536*w(25) + 0.001177514*w(17) + 0.000110825*w(16) - 0.002798327*w(26); 
    0.000697859*w(26) + 0.001268834*w(18) + 0.0000317209*w(17) - 0.001998414*w(27); 
    0.0000910664*w(1) + 0.001514548*w(37) + 0.00065017*w(2) - 0.00225578*w(28); 
    0.0000382453*w(2) + 0.001264066*w(30) + 0.000093668*w(38)+ 0.007881176*w(28) + 0.000239139*w(37) - 0.00951629*w(29); 
    0.003643484*w(3) + 0.000470926*w(31) + 0.000322213*w(4) + 0.002552917*w(39) + 0.000297427*w(29) + 0.000173499*w(38) - 0.00746047*w(30); 
    0.003517065*w(4) + 0.00035927*w(32) + 0.002429801*w(40) + 0.000397088*w(30) + 0.00035927*w(5) + 0.000170181*w(39) - 0.00723267*w(31); 
    0.00306151*w(5) + 0.000346084*w(33) + 0.002249544*w(41) + 0.000341647*w(31) + 0.000141983*w(40) + 0.000150857*w(6) - 0.00629162*w(32); 
    0.002976512*w(6) + 0.000216116*w(34) + 0.002524632*w(42) + 0.000579585*w(32) + 0.00025541*w(7) + 0.000186646*w(41) - 0.0067389*w(33); 
    0.002740699*w(7) + 0.00048216*w(35) + 0.002639192*w(43) + 0.000558291*w(33) + 0.000203015*w(42) + 0.000126884*w(8)- 0.00675024*w(34); 
    0.001699096*w(8) + 0.000274048*w(36) + 0.002904905*w(44) + 0.000383667*w(34) + 0.000274048*w(9) + 0.000164429*w(43) - 0.00570019*w(35); 
    0.003182086*w(9) + 0.00023571*w(17) + 0.002710666*w(45) + 0.000117855*w(44) - 0.00624632*w(36);
    0.00079713*w(28) + 0.000478278*w(38) + 0.000079713*w(29) - 0.00135512*w(37); 
    0.001092794*w(29) + 0.000530786*w(39) + 0.000124891*w(30) + 0.000811799*w(37) - 0.00256026*w(38); 
    0.001330202*w(30) + 0.000527287*w(40) + 0.0000479352*w(31) + 0.000814898*w(38) - 0.00272032*w(39); 
    0.001523857*w(31) + 0.00057392*w(41) + 0.000125339*w(14) - 0.00222312*w(40); 
    0.002134845*w(32) + 0.000943172*w(40) + 0.000632547*w(42) + 0.00012425*w(33) - 0.003834815*w(41);
    0.00064671*w(43) + 0.00083599*w(41) + 0.00015773*w(34) + 0.00132338*w(34)- 0.00291019*w(42); 
    0.001323377*w(34) + 0.000812931*w(44) + 0.001001985*w(42) + 0.0000945269*w(35) - 0.00323282*w(43); 
    0.001495265*w(35) + 0.000539957*w(45) + 0.000830703*w(43)+ 0.0000830703*w(36) - 0.00294899*w(44);
    0.001890084*w(36) + 0.000581564*w(44) - 0.00247165*w(45)];

%y0=[.5; .5; .5; .5; .5; .5; .5; .5; .5; 1; 1; 1; 1; 1; 1; 1; 1; 1; 1; 1; 1; 1; 1; 1; 1; 1; 1; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0]; %initial cond for w(1)=w(1,1,0)=1, int cond for w(2)=w(1,0,0)=1 we will have more of these because we need at least one for each state change.
IC=[zeros(1,4), .5*ones(1,1), ones(1,4), zeros(1,4), .5*ones(1,1), ones(1,4), zeros(1,4), .5*ones(1,1), ones(1,4), zeros(1,4), .5*ones(1,1), ones(1,4), zeros(1,4), .5*ones(1,1), ones(1,4)];
tvalues=[0 50 100 150 200 250 300 350 400 450 500 550 600 650 700 750 800 850 900 950 1000 1050 1100 1150 1200 1250 1300 1350 1400 1450 1500 1550 1600 1650 1700 1750 1800 1850 1900 1950 2000 2050 2100 2150 2200 2250 2300 2350 2400 2450 2500 2550 2600 2650 2700 2750 2800 2850 2900 2950 3000 3050 3100 3150 3200 3250 3300 3350 3400 3450 3500 3550 3600]; 
% this partitions the time range
%tvalues = [0 1 2 3 4];
[t, w]= ode45(odefun, tvalues, IC) 
%solves the dif equation using the DormandâPrince (RKDP) method or DOPRI method an embedded method for solving ordinary differential equations (Dormand & Prince 1980). The method is a member of the RungeâKutta family of ODE solvers. 
%the following plots the win probability function
plot(3600-t,w)
title('Win Probability over time')
xlabel('time(seconds)')
ylabel('Win Probability')
%legend('w(0,-4,t)','w(0,-3,t)','w(0,-2,t)','w(0,-1,t)','w(0,0,t)','w(0,1,t)','w(0,2,t)','w(0,3,t)','w(0,4,t)','w(1,-4,t)','w(1,-3,t)','w(1,-2,t)','w(1,-1,t)','w(1,0,t)','w(1,1,t)','w(1,2,t)','w(1,3,t)','w(1,4,t)','w(2,-4,t)','w(2,-3,t)', 'w(2,-2,t)', 'w(2,-1,t)', 'w(2,0,t)', 'w(2,1,t)', 'w(2,2,t)', 'w(2,3,t)', 'w(2,4,t)', 'w(-1,-4,t)', 'w(-1,-3,t)', 'w(-1,-2,t)', 'w(-1,-1,t)', 'w(-1,0,t)', 'w(-1,1,t)', 'w(-1,2,t)', 'w(-1,3,t)', 'w(-1,4,t)', 'w(-2,-4,t)', 'w(-2,-3,t)', 'w(-2,-2,t)', 'w(-2,-1,t)', 'w(-2,0,t)', 'w(-2,1,t)', 'w(-2,2,t)', 'w(-2,3,t)', 'w(-2,4,t)')
